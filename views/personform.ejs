<!DOCTYPE html>
<html>

<head>
  <title>個人（編集）</title>
  <link rel='stylesheet' href='/stylesheets/style.css' />
</head>

<body>
  <% if (person) { %>
  <a href="/person/<%= person.id %>">戻る</a>
  <% } else { %>
  <a href="/top">戻る</a>
  <% } %>
  <hr>
  <% if (message && message.length !== 0) { %>
  <div class="alert alert-danger">
    <%= message %>
  </div>
  <hr>
  <% } %>
  <h1>個人（編集）</h1>
  <form name="personform" method="POST">
    <!-- ◆登録モード -->
    <% if (mode === 'insert') { %>
    ID:<input type="text" name="id" required>
    <% if (id_company) { %>
    ID_COMPANY:<a href="/company/<%= id_company %>"><%= id_company %></a>
    <input type="hidden" name="id_company" value="<%= id_company %>">
    <% } else { %>
    <select name="id_company">
      <option value="" selected>--会社選択--</option>
      <% companies.forEach(function (company) { %>
      <option value="<%= company.id %>"><%= company.name %></option>
      <% }); %>
    </select>
    <% } %>
    NAME:<input type="text" name="name" required>
    KANA:<input type="text" name="kana">
    TELNO:<input type="text" name="telno">
    TELNO_MOBILE:<input type="text" name="telno_mobile">
    EMAIL:<input type="text" name="email">
    NO_YUBIN:<input type="text" name="no_yubin">
    TODOUFUKEN:<input type="text" name="todoufuken">
    ADDRESS:<input type="text" name="address">
    BIKOU:<input type="text" name="bikou">
    <input type="button" id="btn_insert" value="登録">
    <!-- ◆更新モード -->
    <% } else if (mode === 'update') { %>
    ID:<%= person.id %>
    <input type="hidden" name="id" value="<%= person.id %>">
    <select name="id_company">
      <% companies.forEach(function (company) { %>
      <% if (company.id === person.id_company) { %>
      <option value="<%= company.id %>" selected><%= company.name %></option>
      <% } else { %>
      <option value="<%= company.id %>"><%= company.name %></option>
      <% } %>
      <% }); %>
    </select>
    NAME:<input type="text" name="name" value="<%= person.name %>" required>
    KANA:<input type="text" name="kana" value="<%= person.kana %>">
    TELNO:<input type="text" name="telno" value="<%= person.telno %>">
    TELNO_MOBILE:<input type="text" name="telno_mobile" value="<%= person.telno_mobile %>">
    EMAIL:<input type="text" name="email" value="<%= person.email %>">
    NO_YUBIN:<input type="text" name="no_yubin" value="<%= person.no_yubin %>">
    TODOUFUKEN:<input type="text" name="todoufuken" value="<%= person.todoufuken %>">
    ADDRESS:<input type="text" name="address" value="<%= person.address %>">
    BIKOU:<input type="text" name="bikou" value="<%= person.bikou %>">
    <input type="button" id="btn_update" value="更新">
    <!-- ◆削除モード -->
    <% } else { %>
    ID:<%= person.id %>
    <input type="hidden" name="id" value="<%= person.id %>">
    ID_COMPANY:<%= person.id_company %>
    <input type="hidden" name="id_company" value="<%= person.id_company %>">
    NAME:<%= person.name %>
    KANA:<%= person.kana %>
    TELNO:<%= person.telno %>
    TELNO_MOBILE:<%= person.telno_mobile %>
    EMAIL:<%= person.email %>
    NO_YUBIN:<%= person.no_yubin %>
    TODOUFUKEN:<%= person.todoufuken %>
    ADDRESS:<%= person.address %>
    BIKOU:<%= person.bikou %>
    <input type="button" id="btn_delete" value="削除">
    <% } %>

    <input type="hidden" id="field_mode">
  </form>
  <script>
    let insertbtn = document.getElementById("btn_insert");
    if (insertbtn) {
      insertbtn.addEventListener("click", function () {
        document.personform.action = "/person/insert";
        document.personform.submit();
      })
    }
    let updatebtn = document.getElementById("btn_update");
    if (updatebtn) {
      updatebtn.addEventListener("click", function () {
        document.personform.action = "/person/update";
        document.personform.submit();
      })
    }
    let deletebtn = document.getElementById("btn_delete");
    if (deletebtn) {
      deletebtn.addEventListener("click", function () {
        document.personform.action = "/person/delete";
        document.personform.submit();
      })
    }
  </script>
</body>

</html>